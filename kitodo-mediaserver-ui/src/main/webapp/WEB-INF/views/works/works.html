<!DOCTYPE html>
<!--
  ~ (c) Kitodo. Key to digital objects e. V. <contact@kitodo.org>
  ~
  ~ This file is part of the Kitodo project.
  ~
  ~ It is licensed under GNU General Public License version 3 or later.
  ~
  ~ For the full copyright and license information, please read the
  ~ LICENSE file that was distributed with this source code.
  -->

<html xmlns:th="http://www.thymeleaf.org"
      th:with="lang=${#locale.language}" th:lang="${lang}">
<head th:replace="fragments/head::head(#{works.title})"></head>
<body>

<div class="wrapper">

    <nav th:replace="fragments/nav::nav('works', '')"></nav>

    <div class="content-wrapper">
        <div class="article">

            <div class="main ui container">

                <h1 class="header" th:text="#{works.title}"></h1>

                <p th:text="#{works.description}"></p>

                <form th:replace="fragments/search::search(
                    url = '/works',
                    page = ${page.pageable.getPageNumber()},
                    size = ${page.pageable.getPageSize()},
                    sort = ${sort},
                    search = ${search},
                    availableFields = ${availableFields})"></form>

                <th:block th:if="${searchFields}">
                    <!--/* th:replace has a higher operator precedence than th:if, so it needs to be in a block  */-->
                    <div th:replace="fragments/search::searchFields(${searchFields})"></div>
                </th:block>

                <h2 th:text="#{works.available_works}"></h2>

                <form class="ui form" th:action="@{'/works'}" method="post">

                    <div class="ui positive message" th:if="${not #strings.isEmpty(success)}">
                        <p th:text="#{${success}}"></p>
                    </div>

                    <div class="ui negative message" th:if="${not #strings.isEmpty(error)}">
                        <p th:text="#{${error}}"></p>
                    </div>

                    <div class="ui secondary menu work-actions">

                        <div class="ui dropdown item">
                            <div class="text" th:text="#{form.select}"></div>
                            <i class="dropdown icon"></i>
                            <div class="menu select-works">
                                <div class="item">
                                    <div class="ui checkbox">
                                        <input type="checkbox" checked>
                                        <label>All</label>
                                    </div>
                                </div>
                                <div class="item">
                                    <div class="ui checkbox">
                                        <input type="checkbox">
                                        <label>None</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="ui dropdown item">
                            <div class="text" th:text="#{works.action}"></div>
                            <i class="dropdown icon"></i>
                            <div class="menu">
                                <button class="item" type="submit" name="action" value="cache-clear">
                                    <i class="bolt icon"></i>
                                    <span th:text="#{works.delete_cache}"></span>
                                </button>
                            </div>
                        </div>

                    </div>

                    <div class="ui divider"></div>

                    <div class="ui info message" th:if="${#lists.isEmpty(page.content)}">
                        <p th:text="#{works.no_works_found}"></p>
                    </div>

                    <div class="ui divided items work-items">
                        <div class="item" th:each="work : ${page.content}"
                             th:attr="
                                data-work-id=${work.id},
                                data-work-title=${work.title},
                                data-work-enabled=${work.enabled}">

                            <div class="left floated">
                                <div class="ui checkbox">
                                    <input type="checkbox" name="workIds" th:value="${work.id}">
                                </div>
                            </div>

                            <div class="left floated content">
                                <div class="header" th:text="${work.title}">${work.title}</div>
                                <div class="meta">
                                    <span th:text="${work.id}">${work.id}</span>
                                </div>
                            </div>

                            <div class="right floated">

                                <div class="ui right floated secondary menu">
                                    <div class="fitted item work-lock">
                                        <button type="button" class="ui basic icon button"
                                                th:attrappend="data-tooltip=${work.enabled} ? #{works.unlocked} : #{works.locked}">
                                            <i class="icon"
                                               th:attrappend="class=${work.enabled} ? ' lock open' : ' lock'"
                                               th:classappend="${work.enabled} ? green : grey"></i>
                                        </button>
                                    </div>
                                </div>

                                <div class="ui right floated secondary menu">
                                    <!--/*
                                    For future use here could be buttons to recreate cached derivatives
                                    <a class="item" data-tooltip="recreate cache">
                                        <i class="image outline icon"></i>
                                    </a>
                                    */-->
                                    <div class="fitted item">
                                        <button class="ui basic icon button work-cache-delete"
                                                type="submit" name="action" value="cache-clear"
                                                th:attr="data-tooltip=#{works.delete_cache}">
                                            <i class="bolt icon"></i>
                                        </button>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </div>



                </form>

                <div class="ui divider"></div>

                <div th:replace="fragments/pagination::pagination(
                    url = '/works',
                    page = ${page.pageable.getPageNumber()},
                    totalPages = ${page.getTotalPages()},
                    size = ${page.pageable.getPageSize()},
                    sizes = ${sizes},
                    sort = ${sort},
                    search = ${search})"></div>

            </div>
        </div>
    </div>

</div>

<div class="ui mini modal" id="lock-work-modal">
    <div class="header" th:text="#{works.lock_work}"></div>
    <div class="content">
        <form class="ui form" th:action="@{'/works'}" method="post" id="lock-work-form">
            <input type="hidden" name="workIds" value="">
            <input type="hidden" name="params[enabled]" value="off">
            <div class="field">
                <label th:text="#{works.comment}"></label>
                <textarea name="params[comment]"></textarea>
            </div>
            <div class="field">
                <div class="ui toggle checkbox">
                    <input type="checkbox" class="hidden" name="params[reduce]" th:checked="${reduceMets}">
                    <label th:text="#{works.reduce_mets_file}"></label>
                </div>
            </div>
        </form>
    </div>
    <div class="actions">
        <button type="submit" name="action" value="work-lock" form="lock-work-form"
                class="ui primary right ok button" th:text="#{works.lock}"></button>
        <div class="ui cancel button" th:text="#{form.cancel}"></div>
    </div>
</div>

<div class="ui mini modal" id="work-unlock-modal">
    <div class="header" th:text="#{works.unlock_work}"></div>
    <div class="content">
        <form class="ui form" th:action="@{'/works'}" method="post" id="work-unlock-form">
            <input type="hidden" name="workIds" value="">
            <input type="hidden" name="params[enabled]" value="on">
            <input type="hidden" name="params[comment]" value="">
            <input type="hidden" name="params[reduce]" value="">
            <p th:text="#{works.unlock_work_question}"></p>
            <h4 class="addition header" th:text="#{works.lock_comment_title}"></h4>
            <p class="addition"></p>
        </form>
    </div>
    <div class="actions">
        <button type="submit" name="action" value="work-lock" form="work-unlock-form"
                class="ui primary right ok button" th:text="#{works.unlock}"></button>
        <div class="ui cancel button" th:text="#{form.cancel}"></div>
    </div>
</div>

</body>
</html>
